<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta charset="utf-8" />
		<link rel="stylesheet" type="text/css" href="css/style.css" />
		<title>Swift - NLP - Identification de la langue</title>
	</head>
<body>
<h1>Swift - NLP - Identification de la langue</h1>

<h2>1. Langue dominante</h2>

<p>La première étape du processus va consister à identifier la langue utilisée dans le texte.</p>

<p>L&#39;identification linguistique <sup><a id="ffn1" href="#fn1" class="footnote">1</a></sup> est la tâche de détecter automatiquement la langue et l&#39;écriture d&#39;un morceau de texte. En langage naturel, <strong>NLLanguageRecognizer</strong> <sup><a id="ffn2" href="#fn2" class="footnote">2</a></sup> effectue cette tâche.</p>

<p>À l&#39;aide d&#39;un outil de reconnaissance de langue, vous pouvez obtenir la langue la plus probable pour un morceau de texte d&#39;entrée, ou un ensemble de candidats de langue possibles avec leurs probabilités associées. Vous pouvez également contraindre le processus d&#39;identification en fournissant une liste d&#39;indices sur les probabilités connues pour les langues, ou une liste de langues contre lesquelles les prédictions sont limitées. Vous trouverez des langues prises en charge dans <strong>NLLanguage</strong> <sup><a id="ffn3" href="#fn3" class="footnote">3</a></sup>, mais vous pouvez aussi définir et utiliser vos propres balises de langue.</p>

<p>Pour configurer un «&nbsp;recognizer&nbsp;» il faut créer une instance de <strong>NLLanguageRecognizer</strong> <sup><a id="ffn4" href="#fn4" class="footnote">4</a></sup> et d’appeler sa méthode <strong>processString(</strong><em>:) .</em> <sup><a id="ffn5" href="#fn5" class="footnote">5</a></sup></p>

<p>Par exemple : </p>

<pre><code class="code-highlighted code-swift"><span class="syntax-all syntax-keyword">func</span> <span class="syntax-all syntax-entity">recognizeLanguage</span>(<span class="syntax-all syntax-entity">_</span> <span class="syntax-all syntax-parameter">text</span>: <span class="syntax-all syntax-constant">String</span>) {
    <span class="syntax-all syntax-keyword">let</span> recognizer: NLLanguageRecognizer <span class="syntax-all syntax-keyword">=</span> <span class="syntax-all syntax-constant">NLLanguageRecognizer</span>()
    recognizer.<span class="syntax-all syntax-constant">processString</span>(text)
}</code></pre>

<p>Ici le recognizer est défini, on peut interroger la propriété dominantLanguage pour évaluer la langue dominante du texte, prenons par exemple, six phrases, une en français, une en anglais, une en russe, une en japonais, nue en grec, une en chinois traditionnel et une en hébreu :</p>

<pre><code class="code-highlighted code-swift"><span class="syntax-all syntax-keyword">let</span> textFR <span class="syntax-all syntax-keyword">=</span> <span class="syntax-all syntax-string">&quot;Il était une fois,  dans un royaume fort fort lointain&quot;</span>
<span class="syntax-all syntax-keyword">let</span> textEN <span class="syntax-all syntax-keyword">=</span> <span class="syntax-all syntax-string">&quot;Once upon a time, in a kingdom, far far away&quot;</span>
<span class="syntax-all syntax-keyword">let</span> textRU <span class="syntax-all syntax-keyword">=</span> <span class="syntax-all syntax-string">&quot;Давным-давно, в далёком-далеком королевстве&quot;</span>
<span class="syntax-all syntax-keyword">let</span> textJP <span class="syntax-all syntax-keyword">=</span> <span class="syntax-all syntax-string">&quot;むかしむかし、遠く離れた王国で&quot;</span>
<span class="syntax-all syntax-keyword">let</span> textGR <span class="syntax-all syntax-keyword">=</span> <span class="syntax-all syntax-string">&quot;Μια φορά κι έναν καιρό, σε ένα βασίλειο μακρινό&quot;</span>
<span class="syntax-all syntax-keyword">let</span> textCN <span class="syntax-all syntax-keyword">=</span> <span class="syntax-all syntax-string">&quot;很久很久以前，在一個遙遠的王國里&quot;</span>
<span class="syntax-all syntax-keyword">let</span> textHE <span class="syntax-all syntax-keyword">=</span> <span class="syntax-all syntax-string">&quot;פעם, בממלכה רחוקה רחוקה&quot;</span></code></pre>

<p>Nous allons maintenant créer la méthode qui va permettre de retourner la langue dominante sous la forme d’un paramètre de type NLLanguage? :</p>

<pre><code class="code-highlighted code-swift"><span class="syntax-all syntax-keyword">func</span> <span class="syntax-all syntax-entity">recognizeLanguage</span>(<span class="syntax-all syntax-entity">_</span> <span class="syntax-all syntax-parameter">text</span>: <span class="syntax-all syntax-constant">String</span>) <span class="syntax-all syntax-keyword">-&gt;</span> NLLanguage<span class="syntax-all syntax-keyword">?</span> {
    <span class="syntax-all syntax-keyword">let</span> recognizer: NLLanguageRecognizer <span class="syntax-all syntax-keyword">=</span> <span class="syntax-all syntax-constant">NLLanguageRecognizer</span>()
    recognizer.<span class="syntax-all syntax-constant">processString</span>(text)
    <span class="syntax-all syntax-keyword">return</span> recognizer.<span class="syntax-all syntax-parameter">dominantLanguage</span>
}</code></pre>

<p>Examinons les différentes sorties : </p>

<pre><code class="code-highlighted code-swift"><span class="syntax-all syntax-constant">print</span>(<span class="syntax-all syntax-constant">recognizeLanguage</span>(textFR)<span class="syntax-all syntax-keyword">!</span>.<span class="syntax-all syntax-constant">rawValue</span>)
<span class="syntax-all syntax-constant">print</span>(<span class="syntax-all syntax-constant">recognizeLanguage</span>(textEN)<span class="syntax-all syntax-keyword">!</span>.<span class="syntax-all syntax-constant">rawValue</span>)
<span class="syntax-all syntax-constant">print</span>(<span class="syntax-all syntax-constant">recognizeLanguage</span>(textRU)<span class="syntax-all syntax-keyword">!</span>.<span class="syntax-all syntax-constant">rawValue</span>)
<span class="syntax-all syntax-constant">print</span>(<span class="syntax-all syntax-constant">recognizeLanguage</span>(textJP)<span class="syntax-all syntax-keyword">!</span>.<span class="syntax-all syntax-constant">rawValue</span>)
<span class="syntax-all syntax-constant">print</span>(<span class="syntax-all syntax-constant">recognizeLanguage</span>(textGR)<span class="syntax-all syntax-keyword">!</span>.<span class="syntax-all syntax-constant">rawValue</span>)
<span class="syntax-all syntax-constant">print</span>(<span class="syntax-all syntax-constant">recognizeLanguage</span>(textCN)<span class="syntax-all syntax-keyword">!</span>.<span class="syntax-all syntax-constant">rawValue</span>)
<span class="syntax-all syntax-constant">print</span>(<span class="syntax-all syntax-constant">recognizeLanguage</span>(textHE)<span class="syntax-all syntax-keyword">!</span>.<span class="syntax-all syntax-constant">rawValue</span>)</code></pre>

<p>Renvoie : </p>

<pre><code class="code-highlighted code-swift">fr
en
ru
ja
el
zh<span class="syntax-all syntax-keyword">-</span>Hant
he</code></pre>

<p>Pour plus de clarté, nous allons créer une extension à <strong>NLLanguage</strong> <sup><a id="ffn6" href="#fn6" class="footnote">6</a></sup> et faire un switch sur les langues supportées :</p>

<pre><code class="code-highlighted code-swift"><span class="syntax-all syntax-keyword">extension</span> <span class="syntax-all syntax-entity">NLLanguage</span> {
    <span class="syntax-all syntax-keyword">var</span> languageStr: <span class="syntax-all syntax-constant">String</span> {
        <span class="syntax-all syntax-keyword">switch</span> <span class="syntax-all syntax-constant">self</span> {
            <span class="syntax-all syntax-keyword">case</span> .<span class="syntax-all syntax-parameter">french</span><span class="syntax-all syntax-keyword">:</span>
                <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-string">&quot;French&quot;</span>
            <span class="syntax-all syntax-keyword">case</span> .<span class="syntax-all syntax-parameter">english</span><span class="syntax-all syntax-keyword">:</span>
                <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-string">&quot;English&quot;</span>
            <span class="syntax-all syntax-keyword">case</span> .<span class="syntax-all syntax-parameter">russian</span><span class="syntax-all syntax-keyword">:</span>
                <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-string">&quot;Russian&quot;</span>
            <span class="syntax-all syntax-keyword">case</span> .<span class="syntax-all syntax-parameter">japanese</span><span class="syntax-all syntax-keyword">:</span>
                <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-string">&quot;Japanese&quot;</span>
            <span class="syntax-all syntax-keyword">case</span> .<span class="syntax-all syntax-parameter">greek</span><span class="syntax-all syntax-keyword">:</span>
                <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-string">&quot;Greek&quot;</span>
            <span class="syntax-all syntax-keyword">case</span> .<span class="syntax-all syntax-parameter">traditionalChinese</span><span class="syntax-all syntax-keyword">:</span>
                <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-string">&quot;Traditionnal Chinese&quot;</span>
            <span class="syntax-all syntax-keyword">case</span> .<span class="syntax-all syntax-parameter">hebrew</span><span class="syntax-all syntax-keyword">:</span>
                <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-string">&quot;Hebrew&quot;</span>
            <span class="syntax-all syntax-keyword">default:</span>
                <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-string">&quot;Unknown&quot;</span>
        }
    }
}</code></pre>

<p>Et examinons les sorties :</p>

<pre><code class="code-highlighted code-swift"><span class="syntax-all syntax-constant">print</span>(<span class="syntax-all syntax-constant">recognizeLanguage</span>(textFR)<span class="syntax-all syntax-keyword">!</span>.<span class="syntax-all syntax-parameter">languageStr</span>)
<span class="syntax-all syntax-constant">print</span>(<span class="syntax-all syntax-constant">recognizeLanguage</span>(textEN)<span class="syntax-all syntax-keyword">!</span>.<span class="syntax-all syntax-parameter">languageStr</span>)
<span class="syntax-all syntax-constant">print</span>(<span class="syntax-all syntax-constant">recognizeLanguage</span>(textRU)<span class="syntax-all syntax-keyword">!</span>.<span class="syntax-all syntax-parameter">languageStr</span>)
<span class="syntax-all syntax-constant">print</span>(<span class="syntax-all syntax-constant">recognizeLanguage</span>(textJP)<span class="syntax-all syntax-keyword">!</span>.<span class="syntax-all syntax-parameter">languageStr</span>)
<span class="syntax-all syntax-constant">print</span>(<span class="syntax-all syntax-constant">recognizeLanguage</span>(textGR)<span class="syntax-all syntax-keyword">!</span>.<span class="syntax-all syntax-parameter">languageStr</span>)
<span class="syntax-all syntax-constant">print</span>(<span class="syntax-all syntax-constant">recognizeLanguage</span>(textCN)<span class="syntax-all syntax-keyword">!</span>.<span class="syntax-all syntax-parameter">languageStr</span>)
<span class="syntax-all syntax-constant">print</span>(<span class="syntax-all syntax-constant">recognizeLanguage</span>(textHB)<span class="syntax-all syntax-keyword">!</span>.<span class="syntax-all syntax-parameter">languageStr</span>)</code></pre>

<p>Sorties :</p>

<pre><code class="code-highlighted code-swift">French
English
Russian
Japanese
Greek
Traditionnal Chinese
Hebrew</code></pre>

<p>Dans cette première partie, nous pouvons donc extraire la langue dominante d’un texte, voici le code complet en résumé : </p>

<pre><code class="code-highlighted code-swift"><span class="syntax-all syntax-keyword">import</span> <span class="syntax-all syntax-entity">Foundation</span>
<span class="syntax-all syntax-keyword">import</span> <span class="syntax-all syntax-entity">NaturalLanguage</span>

<span class="syntax-all syntax-keyword">extension</span> <span class="syntax-all syntax-entity">NLLanguage</span> {
    <span class="syntax-all syntax-keyword">var</span> languageStr: <span class="syntax-all syntax-constant">String</span> {
        <span class="syntax-all syntax-keyword">switch</span> <span class="syntax-all syntax-constant">self</span> {
            <span class="syntax-all syntax-keyword">case</span> .<span class="syntax-all syntax-parameter">french</span><span class="syntax-all syntax-keyword">:</span>
                <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-string">&quot;French&quot;</span>
            <span class="syntax-all syntax-keyword">case</span> .<span class="syntax-all syntax-parameter">english</span><span class="syntax-all syntax-keyword">:</span>
                <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-string">&quot;English&quot;</span>
            <span class="syntax-all syntax-keyword">case</span> .<span class="syntax-all syntax-parameter">russian</span><span class="syntax-all syntax-keyword">:</span>
                <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-string">&quot;Russian&quot;</span>
            <span class="syntax-all syntax-keyword">case</span> .<span class="syntax-all syntax-parameter">japanese</span><span class="syntax-all syntax-keyword">:</span>
                <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-string">&quot;Japanese&quot;</span>
            <span class="syntax-all syntax-keyword">case</span> .<span class="syntax-all syntax-parameter">greek</span><span class="syntax-all syntax-keyword">:</span>
                <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-string">&quot;Greek&quot;</span>
            <span class="syntax-all syntax-keyword">case</span> .<span class="syntax-all syntax-parameter">traditionalChinese</span><span class="syntax-all syntax-keyword">:</span>
                <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-string">&quot;Traditionnal Chinese&quot;</span>
            <span class="syntax-all syntax-keyword">case</span> .<span class="syntax-all syntax-parameter">hebrew</span><span class="syntax-all syntax-keyword">:</span>
                <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-string">&quot;Hebrew&quot;</span>
            <span class="syntax-all syntax-keyword">default:</span>
                <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-string">&quot;Unknown&quot;</span>
        }
    }
}

<span class="syntax-all syntax-keyword">let</span> textFR <span class="syntax-all syntax-keyword">=</span> <span class="syntax-all syntax-string">&quot;Il était une fois,  dans un royaume fort fort lointain&quot;</span>
<span class="syntax-all syntax-keyword">let</span> textEN <span class="syntax-all syntax-keyword">=</span> <span class="syntax-all syntax-string">&quot;Once upon a time, in a kingdom, far far away&quot;</span>
<span class="syntax-all syntax-keyword">let</span> textRU <span class="syntax-all syntax-keyword">=</span> <span class="syntax-all syntax-string">&quot;Давным-давно, в далёком-далеком королевстве&quot;</span>
<span class="syntax-all syntax-keyword">let</span> textJP <span class="syntax-all syntax-keyword">=</span> <span class="syntax-all syntax-string">&quot;むかしむかし、遠く離れた王国で&quot;</span>
<span class="syntax-all syntax-keyword">let</span> textGR <span class="syntax-all syntax-keyword">=</span> <span class="syntax-all syntax-string">&quot;Μια φορά κι έναν καιρό, σε ένα βασίλειο μακρινό&quot;</span>
<span class="syntax-all syntax-keyword">let</span> textCN <span class="syntax-all syntax-keyword">=</span> <span class="syntax-all syntax-string">&quot;很久很久以前，在一個遙遠的王國里&quot;</span>
<span class="syntax-all syntax-keyword">let</span> textHB <span class="syntax-all syntax-keyword">=</span> <span class="syntax-all syntax-string">&quot;פעם, בממלכה רחוקה רחוקה&quot;</span>

<span class="syntax-all syntax-keyword">func</span> <span class="syntax-all syntax-entity">recognizeLanguage</span>(<span class="syntax-all syntax-entity">_</span> <span class="syntax-all syntax-parameter">text</span>: <span class="syntax-all syntax-constant">String</span>) <span class="syntax-all syntax-keyword">-&gt;</span> NLLanguage<span class="syntax-all syntax-keyword">?</span> {
    <span class="syntax-all syntax-keyword">let</span> recognizer: NLLanguageRecognizer <span class="syntax-all syntax-keyword">=</span> <span class="syntax-all syntax-constant">NLLanguageRecognizer</span>()
    recognizer.<span class="syntax-all syntax-constant">processString</span>(text)
    <span class="syntax-all syntax-keyword">return</span> recognizer.<span class="syntax-all syntax-parameter">dominantLanguage</span>
}

<span class="syntax-all syntax-constant">print</span>(<span class="syntax-all syntax-constant">recognizeLanguage</span>(textFR)<span class="syntax-all syntax-keyword">!</span>.<span class="syntax-all syntax-parameter">languageStr</span>)
<span class="syntax-all syntax-constant">print</span>(<span class="syntax-all syntax-constant">recognizeLanguage</span>(textEN)<span class="syntax-all syntax-keyword">!</span>.<span class="syntax-all syntax-parameter">languageStr</span>)
<span class="syntax-all syntax-constant">print</span>(<span class="syntax-all syntax-constant">recognizeLanguage</span>(textRU)<span class="syntax-all syntax-keyword">!</span>.<span class="syntax-all syntax-parameter">languageStr</span>)
<span class="syntax-all syntax-constant">print</span>(<span class="syntax-all syntax-constant">recognizeLanguage</span>(textJP)<span class="syntax-all syntax-keyword">!</span>.<span class="syntax-all syntax-parameter">languageStr</span>)
<span class="syntax-all syntax-constant">print</span>(<span class="syntax-all syntax-constant">recognizeLanguage</span>(textGR)<span class="syntax-all syntax-keyword">!</span>.<span class="syntax-all syntax-parameter">languageStr</span>)
<span class="syntax-all syntax-constant">print</span>(<span class="syntax-all syntax-constant">recognizeLanguage</span>(textCN)<span class="syntax-all syntax-keyword">!</span>.<span class="syntax-all syntax-parameter">languageStr</span>)
<span class="syntax-all syntax-constant">print</span>(<span class="syntax-all syntax-constant">recognizeLanguage</span>(textHB)<span class="syntax-all syntax-keyword">!</span>.<span class="syntax-all syntax-parameter">languageStr</span>)</code></pre>

<p>Dans le code précédent je force le unwrap car je sais exactement qu’il n’y aura pas de Nil généré ce qui serait le cas si la langue n’était pas reconnu.</p>

<p>Imaginons un texte en Volapük <a href="https://fr.wikipedia.org/wiki/Volap%C3%BCk">https://fr.wikipedia.org/wiki/Volap%C3%BCk</a></p>

<pre><code class="code-highlighted code-swift"><span class="syntax-all syntax-keyword">let</span> textVolapuk <span class="syntax-all syntax-keyword">=</span> <span class="syntax-all syntax-string">&quot;O fat obas, kel binol in süls, paisaludomöz nem ola&quot;</span>
<span class="syntax-all syntax-keyword">if</span> <span class="syntax-all syntax-keyword">let</span> language <span class="syntax-all syntax-keyword">=</span> <span class="syntax-all syntax-constant">recognizeLanguage</span>(textVolapuk) {
    <span class="syntax-all syntax-constant">print</span>(language.<span class="syntax-all syntax-constant">rawValue</span>)
} <span class="syntax-all syntax-keyword">else</span> {
    <span class="syntax-all syntax-constant">print</span>(<span class="syntax-all syntax-string">&quot;Unknown language&quot;</span>)
}</code></pre>

<p>Alors il faut faire un «&nbsp;safe unwrap&nbsp;»</p>

<h2>2 Obtenir les langues possibles</h2>

<p>Ici nous allons examiner les probabilités de correspondance des langues, grâce à la méthode <strong>languageHypotheses</strong> <sup><a id="ffn7" href="#fn7" class="footnote">7</a></sup></p>

<pre><code class="code-highlighted code-swift"><span class="syntax-all syntax-keyword">@nonobjc</span>
<span class="syntax-all syntax-keyword">func</span> <span class="syntax-all syntax-entity">languageHypotheses</span>(<span class="syntax-all syntax-entity">withMaximum</span> <span class="syntax-all syntax-parameter">maxHypotheses</span>: <span class="syntax-all syntax-constant">Int</span>) <span class="syntax-all syntax-keyword">-&gt;</span> [NLLanguage : <span class="syntax-all syntax-constant">Double</span>]</code></pre>

<p>Je vais donc créer une fonction permettant de retourner la langue possible et sa probabilité sous forme d’un dictionnaire :</p>

<pre><code class="code-highlighted code-swift"><span class="syntax-all syntax-keyword">func</span> <span class="syntax-all syntax-entity">recognizeAndHypotheses</span>(<span class="syntax-all syntax-entity">_</span> <span class="syntax-all syntax-parameter">text</span>: <span class="syntax-all syntax-constant">String</span>) <span class="syntax-all syntax-keyword">-&gt;</span> [NLLanguage: <span class="syntax-all syntax-constant">Double</span>] {
    <span class="syntax-all syntax-keyword">let</span> recognizer: NLLanguageRecognizer <span class="syntax-all syntax-keyword">=</span> <span class="syntax-all syntax-constant">NLLanguageRecognizer</span>()
    recognizer.<span class="syntax-all syntax-constant">processString</span>(text)
    <span class="syntax-all syntax-keyword">return</span> recognizer.<span class="syntax-all syntax-constant">languageHypotheses</span>(<span class="syntax-all syntax-constant">withMaximum</span>: <span class="syntax-all syntax-constant">2</span>)
}</code></pre>

<p>Et en testant avec la phrase en Chinois Traditionnel :</p>

<pre><code class="code-highlighted code-swift"><span class="syntax-all syntax-constant">recognizeAndHypotheses</span>(textCN).<span class="syntax-all syntax-constant">forEach</span> { language, prob <span class="syntax-all syntax-keyword">in</span>
    <span class="syntax-all syntax-constant">print</span>(language.<span class="syntax-all syntax-parameter">languageStr</span>, prob)
}</code></pre>

<p>On Obtient : </p>

<pre><code class="code-highlighted code-swift">Japanese <span class="syntax-all syntax-constant">0.003347375662997365</span>
Traditionnal Chinese <span class="syntax-all syntax-constant">0.9966476559638977</span></code></pre>

<p>Mais ça reste peut lisible, la fonction renvoie un dictionnaire de type :</p>

<pre><code class="code-highlighted code-swift">[NSLanguage<span class="syntax-all syntax-keyword">:</span> <span class="syntax-all syntax-constant">Double</span>]</code></pre>

<p>je vais donc créer une extension à la classe double pour afficher les probabilités sous forme de pourcentage à 3 décimales :</p>

<p>L’extension est très simple : </p>

<pre><code class="code-highlighted code-swift"><span class="syntax-all syntax-keyword">extension</span> <span class="syntax-all syntax-entity">Double</span> {
    <span class="syntax-all syntax-keyword">var</span> toPercent: <span class="syntax-all syntax-constant">String</span><span class="syntax-all syntax-keyword">?</span> {
        <span class="syntax-all syntax-keyword">let</span> formatter: NumberFormatter <span class="syntax-all syntax-keyword">=</span> <span class="syntax-all syntax-constant">NumberFormatter</span>()
        formatter.<span class="syntax-all syntax-parameter">maximumFractionDigits</span> <span class="syntax-all syntax-keyword">=</span> <span class="syntax-all syntax-constant">3</span>
        formatter.<span class="syntax-all syntax-parameter">numberStyle</span> <span class="syntax-all syntax-keyword">=</span> .<span class="syntax-all syntax-parameter">percent</span>
        <span class="syntax-all syntax-keyword">return</span> formatter.<span class="syntax-all syntax-constant">string</span>(<span class="syntax-all syntax-constant">from</span>: <span class="syntax-all syntax-constant">self</span> <span class="syntax-all syntax-keyword">as</span> NSNumber)
    }
}</code></pre>

<p>Injectons celle ci : </p>

<pre><code class="code-highlighted code-swift"><span class="syntax-all syntax-constant">recognizeAndHypotheses</span>(textCN).<span class="syntax-all syntax-constant">forEach</span> { language, prob <span class="syntax-all syntax-keyword">in</span>
    <span class="syntax-all syntax-constant">print</span>(language.<span class="syntax-all syntax-parameter">languageStr</span>, prob.<span class="syntax-all syntax-parameter">toPercent</span><span class="syntax-all syntax-keyword">!</span>)
}</code></pre>

<p>Et la sortie est maintenant bien plus lisible : </p>

<pre><code class="code-highlighted code-swift">Japanese <span class="syntax-all syntax-constant">0</span>,<span class="syntax-all syntax-constant">335</span>&nbsp;<span class="syntax-all syntax-keyword">%</span>
Traditionnal Chinese <span class="syntax-all syntax-constant">99</span>,<span class="syntax-all syntax-constant">665</span>&nbsp;<span class="syntax-all syntax-keyword">%</span></code></pre>

<h2>3 Contraindre la recherche des langues</h2>

<p>Bien que ce soit optionnel il est possible de fournir au &nbsp;<strong>recognizer</strong>&nbsp; des informations qui permettent d’identifier la langue, si on a déjà des indices.</p>

<p>Par exemple si on sait que la langue fera partie d’un certain groupe on peut ajouter une contrainte sur le choix des langues. </p>

<p>Plus spécifiquement on peut donner deux types de <strong>contraintes</strong> :</p>

<ul>
	<li>Une liste de langues qui contraignent la reconnaissance</li>
	<li>Une liste de probabilité pour certaines des langues</li>
</ul>

<p>Imaginons une phrase en espagnol tirée du célèbre Don Quichotte :</p>

<pre><code class="code-highlighted code-swift"><span class="syntax-all syntax-keyword">let</span> donQuixote: <span class="syntax-all syntax-constant">String</span> <span class="syntax-all syntax-keyword">=</span> <span class="syntax-all syntax-string">&quot;Del buen suceso que el valeroso don Quijote tuvo en la espantable y jamás imaginada aventura de los molinos de viento, con otros sucesos dignos de felice recordación&quot;</span></code></pre>

<p>Et créons une méthode avec des contraintes :</p>

<pre><code class="code-highlighted code-swift"><span class="syntax-all syntax-keyword">func</span> <span class="syntax-all syntax-entity">recognizeAndConstraint</span>(<span class="syntax-all syntax-entity">_</span> <span class="syntax-all syntax-parameter">text</span>: <span class="syntax-all syntax-constant">String</span>) <span class="syntax-all syntax-keyword">-&gt;</span> [NLLanguage: <span class="syntax-all syntax-constant">Double</span>] {
    <span class="syntax-all syntax-keyword">let</span> recognizer: NLLanguageRecognizer <span class="syntax-all syntax-keyword">=</span> <span class="syntax-all syntax-constant">NLLanguageRecognizer</span>()
    recognizer.<span class="syntax-all syntax-parameter">languageConstraints</span> <span class="syntax-all syntax-keyword">=</span> [.<span class="syntax-all syntax-parameter">french</span>, .<span class="syntax-all syntax-parameter">portuguese</span>, .<span class="syntax-all syntax-parameter">spanish</span>]
    recognizer.<span class="syntax-all syntax-parameter">languageHints</span> <span class="syntax-all syntax-keyword">=</span> [
        .<span class="syntax-all syntax-parameter">french</span><span class="syntax-all syntax-keyword">:</span> <span class="syntax-all syntax-constant">0.2</span>,
        .<span class="syntax-all syntax-parameter">portuguese</span><span class="syntax-all syntax-keyword">:</span> <span class="syntax-all syntax-constant">0.2</span>,
        .<span class="syntax-all syntax-parameter">spanish</span><span class="syntax-all syntax-keyword">:</span> <span class="syntax-all syntax-constant">0.6</span>
    ]
    recognizer.<span class="syntax-all syntax-constant">processString</span>(text)
    
    <span class="syntax-all syntax-keyword">return</span> recognizer.<span class="syntax-all syntax-constant">languageHypotheses</span>(<span class="syntax-all syntax-constant">withMaximum</span>: <span class="syntax-all syntax-constant">3</span>)
}</code></pre>

<p>La sortie est de fait : </p>

<pre><code class="code-highlighted code-swift"><span class="syntax-all syntax-constant">recognizeAndConstraint</span>(donQuixote).<span class="syntax-all syntax-constant">forEach</span> { language, prob <span class="syntax-all syntax-keyword">in</span>
    <span class="syntax-all syntax-constant">print</span>(language.<span class="syntax-all syntax-parameter">languageStr</span>, prob.<span class="syntax-all syntax-parameter">toPercent</span><span class="syntax-all syntax-keyword">!</span>)
}</code></pre>

<pre><code class="code-highlighted code-swift">French <span class="syntax-all syntax-constant">0</span>&nbsp;<span class="syntax-all syntax-keyword">%</span>
Portuguese <span class="syntax-all syntax-constant">0</span>&nbsp;<span class="syntax-all syntax-keyword">%</span>
Spanish <span class="syntax-all syntax-constant">100</span>&nbsp;<span class="syntax-all syntax-keyword">%</span></code></pre>

<p>En modifiant un peu les contraintes on influe sur les résultats, par exemple :</p>

<pre><code class="code-highlighted code-swift">    recognizer.<span class="syntax-all syntax-parameter">languageConstraints</span> <span class="syntax-all syntax-keyword">=</span> [.<span class="syntax-all syntax-parameter">portuguese</span>, .<span class="syntax-all syntax-parameter">spanish</span>]
    recognizer.<span class="syntax-all syntax-parameter">languageHints</span> <span class="syntax-all syntax-keyword">=</span> [
        .<span class="syntax-all syntax-parameter">portuguese</span><span class="syntax-all syntax-keyword">:</span> <span class="syntax-all syntax-constant">0.99</span>,
        .<span class="syntax-all syntax-parameter">spanish</span><span class="syntax-all syntax-keyword">:</span> <span class="syntax-all syntax-constant">0.01</span>
    ]</code></pre>

<p>Donnera : </p>

<pre><code class="code-highlighted code-swift">Portuguese <span class="syntax-all syntax-constant">0</span>,<span class="syntax-all syntax-constant">006</span>&nbsp;<span class="syntax-all syntax-keyword">%</span>
Spanish <span class="syntax-all syntax-constant">99</span>,<span class="syntax-all syntax-constant">994</span>&nbsp;<span class="syntax-all syntax-keyword">%</span></code></pre>

<h2>4 Exemple d’application</h2>

<p>Dans cet exemple je vais utiliser la <a href="https://developer.apple.com/xcode/">version 15 de Xcode</a> actuellement en beta 6 (10 aout 2023).</p>

<p>L’objectif de cet exemple est d’évaluer au fur et à mesure de la saisie la langue utilisée par l’utilisateur.</p>

<p>Pour commencer nous allons créer deux extensions les mêmes que celles mentionnées au dessus :</p>

<pre><code class="code-highlighted code-swift"><span class="syntax-all syntax-keyword">extension</span> <span class="syntax-all syntax-entity">Double</span> {
    <span class="syntax-all syntax-keyword">var</span> toPercent: <span class="syntax-all syntax-constant">String</span><span class="syntax-all syntax-keyword">?</span> {
        <span class="syntax-all syntax-keyword">let</span> formatter <span class="syntax-all syntax-keyword">=</span> <span class="syntax-all syntax-constant">NumberFormatter</span>()
        formatter.<span class="syntax-all syntax-parameter">maximumFractionDigits</span> <span class="syntax-all syntax-keyword">=</span> <span class="syntax-all syntax-constant">3</span>
        formatter.<span class="syntax-all syntax-parameter">numberStyle</span> <span class="syntax-all syntax-keyword">=</span> .<span class="syntax-all syntax-parameter">percent</span>
        <span class="syntax-all syntax-keyword">return</span> formatter.<span class="syntax-all syntax-constant">string</span>(<span class="syntax-all syntax-constant">from</span>: <span class="syntax-all syntax-constant">self</span> <span class="syntax-all syntax-keyword">as</span> NSNumber)
    }
}</code></pre>

<pre><code class="code-highlighted code-swift"><span class="syntax-all syntax-keyword">extension</span> <span class="syntax-all syntax-entity">NLLanguage</span> {
    <span class="syntax-all syntax-keyword">var</span> flag: <span class="syntax-all syntax-constant">String</span> {
        <span class="syntax-all syntax-keyword">switch</span> <span class="syntax-all syntax-constant">self</span> {
            <span class="syntax-all syntax-keyword">case</span> .<span class="syntax-all syntax-parameter">french</span><span class="syntax-all syntax-keyword">:</span>
                <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-string">&quot;🇫🇷&quot;</span>
            <span class="syntax-all syntax-keyword">case</span> .<span class="syntax-all syntax-parameter">english</span><span class="syntax-all syntax-keyword">:</span>
                <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-string">&quot;🇬🇧&quot;</span>
            <span class="syntax-all syntax-keyword">case</span> .<span class="syntax-all syntax-parameter">spanish</span><span class="syntax-all syntax-keyword">:</span>
                <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-string">&quot;🇪🇸&quot;</span>
            <span class="syntax-all syntax-keyword">case</span> .<span class="syntax-all syntax-parameter">german</span><span class="syntax-all syntax-keyword">:</span>
                <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-string">&quot;🇩🇪&quot;</span>
            <span class="syntax-all syntax-keyword">default:</span>
                <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-string">&quot;🏴‍☠️&quot;</span>
        }
    }
    
    <span class="syntax-all syntax-keyword">var</span> languageString: <span class="syntax-all syntax-constant">String</span> {
        <span class="syntax-all syntax-keyword">switch</span> <span class="syntax-all syntax-constant">self</span> {
            <span class="syntax-all syntax-keyword">case</span> .<span class="syntax-all syntax-parameter">french</span><span class="syntax-all syntax-keyword">:</span>
                <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-string">&quot;French&quot;</span>
            <span class="syntax-all syntax-keyword">case</span> .<span class="syntax-all syntax-parameter">english</span><span class="syntax-all syntax-keyword">:</span>
                <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-string">&quot;English&quot;</span>
            <span class="syntax-all syntax-keyword">case</span> .<span class="syntax-all syntax-parameter">spanish</span><span class="syntax-all syntax-keyword">:</span>
                <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-string">&quot;Spanish&quot;</span>
            <span class="syntax-all syntax-keyword">case</span> .<span class="syntax-all syntax-parameter">german</span><span class="syntax-all syntax-keyword">:</span>
                <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-string">&quot;German&quot;</span>
            <span class="syntax-all syntax-keyword">default:</span>
                <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-string">&quot;Unknown&quot;</span>
        }
    }
}</code></pre>

<p>Ensuite nous allons créer une structure qui permettra de stocker les hypothèses :</p>

<pre><code class="code-highlighted code-swift"><span class="syntax-all syntax-keyword">struct</span> <span class="syntax-all syntax-entity">Hypotheses</span>: Hashable {
    <span class="syntax-all syntax-keyword">let</span> language: NLLanguage
    <span class="syntax-all syntax-keyword">let</span> prob: <span class="syntax-all syntax-constant">Double</span>
    
    <span class="syntax-all syntax-keyword">var</span> languageStr: <span class="syntax-all syntax-constant">String</span> {
        <span class="syntax-all syntax-keyword">return</span> language.<span class="syntax-all syntax-parameter">languageString</span>
    }
    
    <span class="syntax-all syntax-keyword">var</span> flag: <span class="syntax-all syntax-constant">String</span> {
        <span class="syntax-all syntax-keyword">return</span> language.<span class="syntax-all syntax-parameter">flag</span>
    }
}</code></pre>

<p>Maintenant passons à la mise en place la partie reconnaissance, pour ce faire je vais créer une classe et utiliser le framework Observation pour générer la «&nbsp;source of truth&nbsp;» , tout d’abord il faut penser à importer le framework <a href="https://developer.apple.com/documentation/observation"><strong>Observation</strong></a> <sup><a id="ffn8" href="#fn8" class="footnote">8</a></sup></p>

<p>Nous créons donc une class <strong>Recognizer</strong> annotée avec la macro <strong>Observable</strong>, qui contient deux propriétés observables :</p>

<pre><code class="code-highlighted code-swift"><span class="syntax-all syntax-keyword">@Observable</span>
<span class="syntax-all syntax-keyword">final</span> <span class="syntax-all syntax-keyword">class</span> <span class="syntax-all syntax-entity">LangRecognizer</span> {
    <span class="syntax-all syntax-keyword">var</span> text: <span class="syntax-all syntax-constant">String</span> <span class="syntax-all syntax-keyword">=</span> <span class="syntax-all syntax-string">&quot;&quot;</span>
    <span class="syntax-all syntax-keyword">var</span> hypotheses: [Hypotheses] <span class="syntax-all syntax-keyword">=</span> [Hypotheses]()
    
}</code></pre>

<p>Maintenant nous ajoutons la méthode permettant la reconnaissance de la langue :</p>

<pre><code class="code-highlighted code-swift">    <span class="syntax-all syntax-keyword">func</span> <span class="syntax-all syntax-entity">recognize</span>() {
        recognizer.<span class="syntax-all syntax-constant">processString</span>(text)
        <span class="syntax-all syntax-keyword">let</span> hypothesesDictionnary <span class="syntax-all syntax-keyword">=</span> recognizer.<span class="syntax-all syntax-constant">languageHypotheses</span>(<span class="syntax-all syntax-constant">withMaximum</span>: <span class="syntax-all syntax-constant">3</span>)
        
        hypotheses <span class="syntax-all syntax-keyword">=</span> hypothesesDictionnary.<span class="syntax-all syntax-constant">map</span> { lang, prob <span class="syntax-all syntax-keyword">in</span>
            <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-constant">Hypotheses</span>(<span class="syntax-all syntax-constant">language</span>: lang, <span class="syntax-all syntax-constant">prob</span>: prob)
        }
    }</code></pre>

<p>Pour l’interface utilisateur, quelque chose de simple un <a href="https://developer.apple.com/documentation/swiftui/texteditor">texteditor</a> et un composant <a href="https://developer.apple.com/documentation/swiftui/list">list</a> qui affichera la liste des hypothèses :</p>

<pre><code class="code-highlighted code-swift"><span class="syntax-all syntax-keyword">struct</span> <span class="syntax-all syntax-entity">ContentView</span>: View {
    
    <span class="syntax-all syntax-keyword">@State</span> <span class="syntax-all syntax-keyword">private</span> <span class="syntax-all syntax-keyword">var</span> langRecognizer <span class="syntax-all syntax-keyword">=</span> <span class="syntax-all syntax-constant">LangRecognizer</span>()
    
    <span class="syntax-all syntax-keyword">var</span> body: <span class="syntax-all syntax-keyword">some</span> View {
        VStack {
            <span class="syntax-all syntax-constant">TextEditor</span>(<span class="syntax-all syntax-constant">text</span>: $langRecognizer.<span class="syntax-all syntax-constant">text</span>)
                .<span class="syntax-all syntax-parameter">overlay</span> {
                    <span class="syntax-all syntax-constant">RoundedRectangle</span>(<span class="syntax-all syntax-constant">cornerRadius</span>: <span class="syntax-all syntax-constant">12</span>)
                        .<span class="syntax-all syntax-constant">stroke</span>(<span class="syntax-all syntax-constant">lineWidth</span>: <span class="syntax-all syntax-constant">2</span>)
                    
                }
            List {
                <span class="syntax-all syntax-constant">ForEach</span>(<span class="syntax-all syntax-constant">1</span><span class="syntax-all syntax-keyword">..&lt;</span><span class="syntax-all syntax-constant">6</span>, <span class="syntax-all syntax-constant">id</span>: \.<span class="syntax-all syntax-keyword">self</span>) { i <span class="syntax-all syntax-keyword">in</span>
                    <span class="syntax-all syntax-constant">Text</span>(<span class="syntax-all syntax-string">&quot;\(</span><span class="syntax-all syntax-parameter">i</span><span class="syntax-all syntax-string">)&quot;</span>)
                }
            }
            .<span class="syntax-all syntax-constant">listStyle</span>(.<span class="syntax-all syntax-parameter">plain</span>)
        }
        .<span class="syntax-all syntax-constant">padding</span>()
    }
}</code></pre>

<p>Il suffit maintenant d’&nbsp;<em>observer</em> les changements du composant <a href="https://developer.apple.com/documentation/swiftui/texteditor">texteditor</a> :</p>

<pre><code class="code-highlighted code-swift"><span class="syntax-all syntax-constant">TextEditor</span>(<span class="syntax-all syntax-constant">text</span>: $langRecognizer.<span class="syntax-all syntax-constant">text</span>)
    .<span class="syntax-all syntax-parameter">overlay</span> {
        <span class="syntax-all syntax-constant">RoundedRectangle</span>(<span class="syntax-all syntax-constant">cornerRadius</span>: <span class="syntax-all syntax-constant">12</span>)
            .<span class="syntax-all syntax-constant">stroke</span>(<span class="syntax-all syntax-constant">lineWidth</span>: <span class="syntax-all syntax-constant">2</span>)
        
    }
    .<span class="syntax-all syntax-constant">onChange</span>(<span class="syntax-all syntax-constant">of</span>: langRecognizer.<span class="syntax-all syntax-constant">text</span>) { <span class="syntax-all syntax-constant">_</span>, <span class="syntax-all syntax-constant">_</span> <span class="syntax-all syntax-keyword">in</span>
        langRecognizer.<span class="syntax-all syntax-constant">recognize</span>()
    }</code></pre>

<p>Puis d’afficher les hypothèses dans le composant <a href="https://developer.apple.com/documentation/swiftui/list">list</a>: </p>

<pre><code class="code-highlighted code-swift">List {
    <span class="syntax-all syntax-constant">ForEach</span>(langRecognizer.<span class="syntax-all syntax-parameter">hypotheses</span>, <span class="syntax-all syntax-constant">id</span>: \.<span class="syntax-all syntax-keyword">self</span>) { hypothese <span class="syntax-all syntax-keyword">in</span>
        HStack {
            <span class="syntax-all syntax-constant">Text</span>(hypothese.<span class="syntax-all syntax-parameter">flag</span>)
            <span class="syntax-all syntax-constant">Text</span>(hypothese.<span class="syntax-all syntax-parameter">languageStr</span>)
            <span class="syntax-all syntax-constant">Spacer</span>()
            <span class="syntax-all syntax-constant">Text</span>(hypothese.<span class="syntax-all syntax-parameter">prob</span>.<span class="syntax-all syntax-parameter">toPercent</span><span class="syntax-all syntax-keyword">!</span>)
        }
    }
}</code></pre>

<p>On peut aussi utiliser une variable calculée pour afficher les hypothèses dans l’ordre des probabilités :</p>

<pre><code class="code-highlighted code-swift"><span class="syntax-all syntax-keyword">var</span> sortedHypothese: [Hypotheses] {
    <span class="syntax-all syntax-keyword">return</span> langRecognizer.<span class="syntax-all syntax-parameter">hypotheses</span>.<span class="syntax-all syntax-constant">sorted</span> { <span class="syntax-all syntax-constant">$0</span>.<span class="syntax-all syntax-parameter">prob</span> <span class="syntax-all syntax-keyword">&gt;</span> <span class="syntax-all syntax-constant">$1</span>.<span class="syntax-all syntax-parameter">prob</span> }
}</code></pre>

<p>Et l’injecter dans la liste, ce qui donne le code complet suivant : </p>

<pre><code class="code-highlighted code-swift"><span class="syntax-all syntax-comment">//</span>
<span class="syntax-all syntax-comment">//  ContentView.swift</span>
<span class="syntax-all syntax-comment">//  LanguageDetectioniOS17</span>
<span class="syntax-all syntax-comment">//</span>
<span class="syntax-all syntax-comment">//  Created by David Tavan on 02/08/2023.</span>
<span class="syntax-all syntax-comment">//</span>

<span class="syntax-all syntax-keyword">import</span> <span class="syntax-all syntax-entity">SwiftUI</span>
<span class="syntax-all syntax-keyword">import</span> <span class="syntax-all syntax-entity">NaturalLanguage</span>

<span class="syntax-all syntax-keyword">extension</span> <span class="syntax-all syntax-entity">Double</span> {
    <span class="syntax-all syntax-keyword">var</span> toPercent: <span class="syntax-all syntax-constant">String</span><span class="syntax-all syntax-keyword">?</span> {
        <span class="syntax-all syntax-keyword">let</span> formatter <span class="syntax-all syntax-keyword">=</span> <span class="syntax-all syntax-constant">NumberFormatter</span>()
        formatter.<span class="syntax-all syntax-parameter">maximumFractionDigits</span> <span class="syntax-all syntax-keyword">=</span> <span class="syntax-all syntax-constant">3</span>
        formatter.<span class="syntax-all syntax-parameter">numberStyle</span> <span class="syntax-all syntax-keyword">=</span> .<span class="syntax-all syntax-parameter">percent</span>
        <span class="syntax-all syntax-keyword">return</span> formatter.<span class="syntax-all syntax-constant">string</span>(<span class="syntax-all syntax-constant">from</span>: <span class="syntax-all syntax-constant">self</span> <span class="syntax-all syntax-keyword">as</span> NSNumber)
    }
}

<span class="syntax-all syntax-keyword">extension</span> <span class="syntax-all syntax-entity">NLLanguage</span> {
    <span class="syntax-all syntax-keyword">var</span> flag: <span class="syntax-all syntax-constant">String</span> {
        <span class="syntax-all syntax-keyword">switch</span> <span class="syntax-all syntax-constant">self</span> {
            <span class="syntax-all syntax-keyword">case</span> .<span class="syntax-all syntax-parameter">french</span><span class="syntax-all syntax-keyword">:</span>
                <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-string">&quot;🇫🇷&quot;</span>
            <span class="syntax-all syntax-keyword">case</span> .<span class="syntax-all syntax-parameter">english</span><span class="syntax-all syntax-keyword">:</span>
                <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-string">&quot;🇬🇧&quot;</span>
            <span class="syntax-all syntax-keyword">case</span> .<span class="syntax-all syntax-parameter">spanish</span><span class="syntax-all syntax-keyword">:</span>
                <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-string">&quot;🇪🇸&quot;</span>
            <span class="syntax-all syntax-keyword">case</span> .<span class="syntax-all syntax-parameter">german</span><span class="syntax-all syntax-keyword">:</span>
                <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-string">&quot;🇩🇪&quot;</span>
            <span class="syntax-all syntax-keyword">default:</span>
                <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-string">&quot;🏴‍☠️&quot;</span>
        }
    }
    
    <span class="syntax-all syntax-keyword">var</span> languageString: <span class="syntax-all syntax-constant">String</span> {
        <span class="syntax-all syntax-keyword">switch</span> <span class="syntax-all syntax-constant">self</span> {
            <span class="syntax-all syntax-keyword">case</span> .<span class="syntax-all syntax-parameter">french</span><span class="syntax-all syntax-keyword">:</span>
                <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-string">&quot;French&quot;</span>
            <span class="syntax-all syntax-keyword">case</span> .<span class="syntax-all syntax-parameter">english</span><span class="syntax-all syntax-keyword">:</span>
                <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-string">&quot;English&quot;</span>
            <span class="syntax-all syntax-keyword">case</span> .<span class="syntax-all syntax-parameter">spanish</span><span class="syntax-all syntax-keyword">:</span>
                <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-string">&quot;Spanish&quot;</span>
            <span class="syntax-all syntax-keyword">case</span> .<span class="syntax-all syntax-parameter">german</span><span class="syntax-all syntax-keyword">:</span>
                <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-string">&quot;German&quot;</span>
            <span class="syntax-all syntax-keyword">default:</span>
                <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-string">&quot;Unknown&quot;</span>
        }
    }
}

<span class="syntax-all syntax-keyword">struct</span> <span class="syntax-all syntax-entity">Hypotheses</span>: Hashable {
    <span class="syntax-all syntax-keyword">let</span> language: NLLanguage
    <span class="syntax-all syntax-keyword">let</span> prob: <span class="syntax-all syntax-constant">Double</span>
    
    <span class="syntax-all syntax-keyword">var</span> languageStr: <span class="syntax-all syntax-constant">String</span> {
        <span class="syntax-all syntax-keyword">return</span> language.<span class="syntax-all syntax-parameter">languageString</span>
    }
    
    <span class="syntax-all syntax-keyword">var</span> flag: <span class="syntax-all syntax-constant">String</span> {
        <span class="syntax-all syntax-keyword">return</span> language.<span class="syntax-all syntax-parameter">flag</span>
    }
}

<span class="syntax-all syntax-keyword">@Observable</span>
<span class="syntax-all syntax-keyword">final</span> <span class="syntax-all syntax-keyword">class</span> <span class="syntax-all syntax-entity">LangRecognizer</span> {
    <span class="syntax-all syntax-keyword">var</span> text: <span class="syntax-all syntax-constant">String</span> <span class="syntax-all syntax-keyword">=</span> <span class="syntax-all syntax-string">&quot;&quot;</span>
    <span class="syntax-all syntax-keyword">var</span> hypotheses: [Hypotheses] <span class="syntax-all syntax-keyword">=</span> [Hypotheses]()
    
    <span class="syntax-all syntax-keyword">private</span> <span class="syntax-all syntax-keyword">let</span> recognizer: NLLanguageRecognizer <span class="syntax-all syntax-keyword">=</span> <span class="syntax-all syntax-constant">NLLanguageRecognizer</span>()
    
    <span class="syntax-all syntax-keyword">func</span> <span class="syntax-all syntax-entity">recognize</span>() {
        recognizer.<span class="syntax-all syntax-constant">processString</span>(text)
        <span class="syntax-all syntax-keyword">let</span> hypothesesDictionnary <span class="syntax-all syntax-keyword">=</span> recognizer.<span class="syntax-all syntax-constant">languageHypotheses</span>(<span class="syntax-all syntax-constant">withMaximum</span>: <span class="syntax-all syntax-constant">3</span>)
        
        hypotheses <span class="syntax-all syntax-keyword">=</span> hypothesesDictionnary.<span class="syntax-all syntax-constant">map</span> { lang, prob <span class="syntax-all syntax-keyword">in</span>
            <span class="syntax-all syntax-keyword">return</span> <span class="syntax-all syntax-constant">Hypotheses</span>(<span class="syntax-all syntax-constant">language</span>: lang, <span class="syntax-all syntax-constant">prob</span>: prob)
        }
    }
}

<span class="syntax-all syntax-keyword">struct</span> <span class="syntax-all syntax-entity">ContentView</span>: View {
    
    <span class="syntax-all syntax-keyword">@State</span> <span class="syntax-all syntax-keyword">private</span> <span class="syntax-all syntax-keyword">var</span> langRecognizer <span class="syntax-all syntax-keyword">=</span> <span class="syntax-all syntax-constant">LangRecognizer</span>()
    
    <span class="syntax-all syntax-keyword">var</span> sortedHypothese: [Hypotheses] {
        <span class="syntax-all syntax-keyword">return</span> langRecognizer.<span class="syntax-all syntax-parameter">hypotheses</span>.<span class="syntax-all syntax-constant">sorted</span> { <span class="syntax-all syntax-constant">$0</span>.<span class="syntax-all syntax-parameter">prob</span> <span class="syntax-all syntax-keyword">&gt;</span> <span class="syntax-all syntax-constant">$1</span>.<span class="syntax-all syntax-parameter">prob</span> }
    }
    
    <span class="syntax-all syntax-keyword">var</span> body: <span class="syntax-all syntax-keyword">some</span> View {
        VStack {
            <span class="syntax-all syntax-constant">TextEditor</span>(<span class="syntax-all syntax-constant">text</span>: $langRecognizer.<span class="syntax-all syntax-constant">text</span>)
                .<span class="syntax-all syntax-parameter">overlay</span> {
                    <span class="syntax-all syntax-constant">RoundedRectangle</span>(<span class="syntax-all syntax-constant">cornerRadius</span>: <span class="syntax-all syntax-constant">12</span>)
                        .<span class="syntax-all syntax-constant">stroke</span>(<span class="syntax-all syntax-constant">lineWidth</span>: <span class="syntax-all syntax-constant">2</span>)
                    
                }
                .<span class="syntax-all syntax-constant">onChange</span>(<span class="syntax-all syntax-constant">of</span>: langRecognizer.<span class="syntax-all syntax-constant">text</span>) { <span class="syntax-all syntax-constant">_</span>, <span class="syntax-all syntax-constant">_</span> <span class="syntax-all syntax-keyword">in</span>
                    langRecognizer.<span class="syntax-all syntax-constant">recognize</span>()
                }
            List {
                <span class="syntax-all syntax-constant">ForEach</span>(sortedHypothese, <span class="syntax-all syntax-constant">id</span>: \.<span class="syntax-all syntax-keyword">self</span>) { hypothese <span class="syntax-all syntax-keyword">in</span>
                    HStack {
                        <span class="syntax-all syntax-constant">Text</span>(hypothese.<span class="syntax-all syntax-parameter">flag</span>)
                        <span class="syntax-all syntax-constant">Text</span>(hypothese.<span class="syntax-all syntax-parameter">languageStr</span>)
                        <span class="syntax-all syntax-constant">Spacer</span>()
                        <span class="syntax-all syntax-constant">Text</span>(hypothese.<span class="syntax-all syntax-parameter">prob</span>.<span class="syntax-all syntax-parameter">toPercent</span><span class="syntax-all syntax-keyword">!</span>)
                    }
                }
            }
            .<span class="syntax-all syntax-constant">listStyle</span>(.<span class="syntax-all syntax-parameter">plain</span>)
        }
        .<span class="syntax-all syntax-constant">padding</span>()
    }
}

#Preview {
    <span class="syntax-all syntax-constant">ContentView</span>()
}</code></pre>

<figure><img src="truc.gif"/></figure>

<ol id="footnotes">
	<li id="fn1"><a href="https://developer.apple.com/documentation/naturallanguage/identifying_the_language_in_text" title="Identifying the language in text">https://developer.apple.com/documentation/naturallanguage/identifying_the_language_in_text</a> <a href="#ffn1">&#x21A9;&#xFE0E;</a></li>
	<li id="fn2"><a href="https://developer.apple.com/documentation/naturallanguage/nllanguagerecognizer" title="NLLanguageRecognizer">https://developer.apple.com/documentation/naturallanguage/nllanguagerecognizer</a> <a href="#ffn2">&#x21A9;&#xFE0E;</a></li>
	<li id="fn3"><a href="https://developer.apple.com/documentation/naturallanguage/nllanguage" title="NLLanguage">https://developer.apple.com/documentation/naturallanguage/nllanguage</a> <a href="#ffn3">&#x21A9;&#xFE0E;</a></li>
	<li id="fn4"><a href="https://developer.apple.com/documentation/naturallanguage/nllanguagerecognizer" title="NLLanguageRecognizer">https://developer.apple.com/documentation/naturallanguage/nllanguagerecognizer</a> <a href="#ffn4">&#x21A9;&#xFE0E;</a></li>
	<li id="fn5"><a href="https://developer.apple.com/documentation/naturallanguage/nllanguagerecognizer/2976562-processstring" title="ProcessString">https://developer.apple.com/documentation/naturallanguage/nllanguagerecognizer/2976562-processstring</a> <a href="#ffn5">&#x21A9;&#xFE0E;</a></li>
	<li id="fn6"><a href="https://developer.apple.com/documentation/naturallanguage/nllanguage" title="NLLanguage">https://developer.apple.com/documentation/naturallanguage/nllanguage</a> <a href="#ffn6">&#x21A9;&#xFE0E;</a></li>
	<li id="fn7"><a href="https://developer.apple.com/documentation/naturallanguage/nllanguagerecognizer/2976561-languagehypotheses">https://developer.apple.com/documentation/naturallanguage/nllanguagerecognizer/2976561-languagehypotheses</a> <a href="#ffn7">&#x21A9;&#xFE0E;</a></li>
	<li id="fn8"><a href="https://developer.apple.com/documentation/observation">https://developer.apple.com/documentation/observation</a> <a href="#ffn8">&#x21A9;&#xFE0E;</a></li>
</ol></body>
</html>

